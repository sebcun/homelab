<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ config.home.title }} Dashboard</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='base.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='dashboard.css') }}"
    />
    <style>
      :root {
        --primary: {{ config.colors.primary }};
        --primary-rgb: {{ config.colors.primary_rgb }};
        --primary-hover: {{ config.colors.primary_hover }};
        --primary-hover-rgb: {{ config.colors.primary_hover_rgb }};
        --background-dark: {{ config.colors.background_dark }};
        --background-dark-rgb: {{ config.colors.background_dark_rgb }};
        --background-secondary: {{ config.colors.background_secondary }};
        --background-secondary-rgb: {{ config.colors.background_secondary_rgb }};
        --text-white: {{ config.colors.text_white }};
        --text-white-rgb: {{ config.colors.text_white_rgb }};
        --text-light: {{ config.colors.text_light }};
        --text-medium: {{ config.colors.text_medium }};
        --text-gray: {{ config.colors.text_gray }};
        --text-dark-gray: {{ config.colors.text_dark_gray }};
        --neutral-rgb: {{ config.colors.hero_gradial_rgb }};
      }
    </style>
  </head>

  <body>
    <nav class="navbar">
      <ul>
        <li><a href="/">Home</a></li>
        <li><a href="/dashboard">Dashboard</a></li>
        {% if is_organiser %}
        <li><a href="/organiser">Organiser</a></li>
        {% endif %}
        <li><a href="/logout">Logout</a></li>
      </ul>
    </nav>

    <main class="dashboard-content">
      <header class="dashboard-header">
        <h1>{{ config.home.title }} Organiser Dashboard</h1>
      </header>

      <section class="projects-section">
        <h2>Program Statistics</h2>
        <div class="stats-container">
          <div class="stat-card">
            <div class="stat-number">{{ total_projects }}</div>
            <div class="stat-label">Total Projects</div>
          </div>
        </div>
      </section>

      <section class="projects-section">
        <h2>All Projects</h2>
        <div class="carousel" style="padding-left: 1rem">
          {% for project in all_projects %}
          <div class="project-card">
            <div class="project-header">
              <h3>{{ project[1] }}</h3>
              <span class="project-status status-pending"
                >{{ project[6] }}</span
              >
            </div>
            <p class="project-description">{{ project[2] }}</p>
            <div class="project-author">
              <span class="author-info"
                >By
                <a
                  href="https://hackclub.enterprise.slack.com/team/{{ project[9] }}"
                  >@{{ project[8] }}</a
                ></span
              >
            </div>
            <div class="project-footer">
              <span class="project-hours"></span>
              <a
                href="#"
                class="btn btn-small"
                onclick="openViewModal({{ project[0] }})"
                >View</a
              >
            </div>
          </div>
          {% endfor %}
        </div>
      </section>
    </main>

    <div id="viewProjectModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeViewModal()">&times;</span>
        <h2>View Project</h2>
        <div id="viewProjectContent">
          <label for="viewTitle">Title</label>
          <input type="text" id="viewTitle" readonly />

          <label for="viewAuthor">Author</label>
          <input type="text" id="viewAuthor" readonly />

          <label for="viewDescription">Description</label>
          <textarea id="viewDescription" readonly></textarea>

          <label for="viewDemoLink">Demo Link</label>
          <input type="url" id="viewDemoLink" readonly />

          <label for="viewGithubLink">GitHub Link</label>
          <input type="url" id="viewGithubLink" readonly />

          <label for="viewHours">Hours</label>
          <input type="text" id="viewHours" readonly />

          <div class="modal-buttons">
            <button type="button" class="btn-delete" onclick="deleteProject()">
              Delete Project
            </button>
          </div>
        </div>
        <form
          id="deleteProjectForm"
          action="/organiser_delete_project"
          method="post"
          style="display: none"
        >
          <input type="hidden" name="project_id" id="deleteProjectId" />
        </form>
      </div>
    </div>

    <script>
      const allProjects = {{ all_projects | tojson }};

      function openViewModal(projectId) {
        const project = allProjects.find(p => p[0] === projectId);
        if (!project) return;

        document.getElementById('viewTitle').value = project[1];
        document.getElementById('viewAuthor').value = project[8] + ' (' + project[9] + ')';
        document.getElementById('viewDescription').value = project[2];
        document.getElementById('viewDemoLink').value = project[3] || '';
        document.getElementById('viewGithubLink').value = project[4] || '';
        document.getElementById('viewHours').value = project[5];
        document.getElementById('deleteProjectId').value = project[0];

        const modal = document.getElementById("viewProjectModal");
        modal.style.display = "block";
        setTimeout(() => {
          modal.style.opacity = "1";
          modal.style.visibility = "visible";
        }, 10);
      }

      function closeViewModal() {
        const modal = document.getElementById("viewProjectModal");
        modal.style.opacity = "0";
        modal.style.visibility = "hidden";
        setTimeout(() => {
          modal.style.display = "none";
        }, 300);
      }

      function deleteProject() {
        if (confirm("Are you sure you want to delete this project? This action cannot be undone.")) {
          document.getElementById('deleteProjectForm').submit();
        }
      }

      window.onclick = function (event) {
        const viewModal = document.getElementById("viewProjectModal");
        if (event.target === viewModal) {
          closeViewModal();
        }
      };
    </script>
  </body>
</html>
